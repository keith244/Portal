{% extends 'layout/base.html' %}
{% block content %}
<div class="text-center">
  <h4>Step 2 of 4</h4>
  <h3>Education Level</h3>
</div>
<div class="card">
  <div class="card-body">
    <h5 class="card-title"> Education Level</h5>

    <!-- General Form Elements -->
    <form method="POST" id="educationForm" action="{% url 'education' %}">
      {% csrf_token %}
      <div class="row mb-3">
        <label for="education" class="col-sm-2 col-form-label">Education</label>
        <div class="col-sm-10">
          <select class="form-control" name="education" id="education" required>
            <option value="">Select Education Level</option>
            <option value="Primary">Primary</option>
            <option value="Secondary">Secondary</option>
            <option value="University">University</option>
          </select>
        </div>
      </div>
      <div id="schoolNameSection" style="display: none;">
        <div class="row mb-3">
          <label for="primarySchoolName" class="col-sm-2 col-form-label">School Name (Primary)</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" name="primary_school_name" id="primarySchoolName">
          </div>
        </div>
      </div>
      <div id="coursePursuedSection" style="display: none;">
        <div class="row mb-3">
          <label for="course" class="col-sm-2 col-form-label">Course Pursued (University)</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" name="course" id="course">
          </div>
        </div>
        <div class="row mb-3">
          <label for="universityName" class="col-sm-2 col-form-label">University Name (University)</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" name="university_name" id="universityName">
          </div>
        </div>
      </div>
      <div id="institutionSection" style="display: none;">
        <div class="form-group">
          <label for="institution">Institution</label>
          <select class="form-control" name="institution" id="institution">
            <option value="">Select Institution</option>
            <option value="Adventist University of Africa">Adventist University of Africa</option>
            <option value="Africa International University">Africa International University</option>
            <option value="Africa Nazarene University">Africa Nazarene University</option>
            <option value="Amref International University">Amref International University</option>
            <!-- Add more options as needed -->
          </select>
        </div>
      </div>
      <div class="row mb-3">
        <label class="col-sm-2 col-form-label">Years Attended</label>
        <div class="col-sm-5">
          <input type="number" class="form-control" name="start_year" id="startYear" placeholder="Start Year">
        </div>
        <div class="col-sm-5">
          <input type="number" class="form-control" name="end_year" id="endYear" placeholder="End Year">
        </div>
      </div>
      <div class="row mb-3" id="additionalCoursesSection" style="display: none;">
        <label for="add_courses" class="col-sm-2 col-form-label">Additional Courses</label>
        <div class="col-sm-10">
          <input type="text" class="form-control" name="add_courses" id="add_courses">
        </div>
      </div>

      <div class="col-sm-10">
        <button type="button" class="btn btn-success" id="saveBtn">Save</button>
        <button type="button" id="proceedBtn" class="btn btn-success">Proceed</button>
        <div id="errorMessage" style="color: red; display: none;">Please save the form and fill all required fields.</div>
      </div>
    </form><!-- End General Form Elements -->

  </div>
</div>

<script>
  // Function to check if the form is valid
  function isFormValid() {
    return document.getElementById('educationForm').checkValidity();
  }

  // Function to save form data to sessionStorage
  function saveFormData() {
    sessionStorage.setItem('education', document.getElementById('education').value);
    sessionStorage.setItem('primarySchoolName', document.getElementById('primarySchoolName').value);
    sessionStorage.setItem('course', document.getElementById('course').value);
    sessionStorage.setItem('universityName', document.getElementById('universityName').value);
    sessionStorage.setItem('institution', document.getElementById('institution').value);
    sessionStorage.setItem('startYear', document.getElementById('startYear').value);
    sessionStorage.setItem('endYear', document.getElementById('endYear').value);
    sessionStorage.setItem('addCourses', document.getElementById('add_courses').value);
  }

  // Function to populate form fields from sessionStorage
  function populateFormFromStorage() {
    document.getElementById('education').value = sessionStorage.getItem('education') || '';
    document.getElementById('primarySchoolName').value = sessionStorage.getItem('primarySchoolName') || '';
    document.getElementById('course').value = sessionStorage.getItem('course') || '';
    document.getElementById('universityName').value = sessionStorage.getItem('universityName') || '';
    document.getElementById('institution').value = sessionStorage.getItem('institution') || '';
    document.getElementById('startYear').value = sessionStorage.getItem('startYear') || '';
    document.getElementById('endYear').value = sessionStorage.getItem('endYear') || '';
    document.getElementById('add_courses').value = sessionStorage.getItem('addCourses') || '';
  }

  // Populate form fields on page load
  window.addEventListener('load', function() {
    populateFormFromStorage();
    checkEducationLevel(); // Check education level on page load
  });

  // Function to check selected education level and show/hide sections accordingly
  function checkEducationLevel() {
    var educationLevel = document.getElementById('education').value;
    if (educationLevel === 'Primary') {
      document.getElementById('schoolNameSection').style.display = 'block';
      document.getElementById('coursePursuedSection').style.display = 'none';
      document.getElementById('institutionSection').style.display = 'none';
      document.getElementById('additionalCoursesSection').style.display = 'none';
    } else if (educationLevel === 'Secondary') {
      document.getElementById('schoolNameSection').style.display = 'block';
      document.getElementById('coursePursuedSection').style.display = 'none';
      document.getElementById('institutionSection').style.display = 'none';
      document.getElementById('additionalCoursesSection').style.display = 'none';
    } else if (educationLevel === 'University') {
      document.getElementById('schoolNameSection').style.display = 'none';
      document.getElementById('coursePursuedSection').style.display = 'block';
      document.getElementById('institutionSection').style.display = 'block';
      document.getElementById('additionalCoursesSection').style.display = 'block';
    } else {
      // Default case if none selected
      document.getElementById('schoolNameSection').style.display = 'none';
      document.getElementById('coursePursuedSection').style.display = 'none';
      document.getElementById('institutionSection').style.display = 'none';
      document.getElementById('additionalCoursesSection').style.display = 'none';
    }
  }

  // Education level change event listener
  document.getElementById('education').addEventListener('change', function(event) {
    checkEducationLevel();
  });

  // Save button click event listener
  document.getElementById('saveBtn').addEventListener('click', function(event) {
    if (isFormValid() && areRequiredFieldsFilled()) {
      saveFormData();
      alert('Education form saved successfully.');
    } else {
      showErrorMessage('Please fill in all required fields.');
    }
  });

  // Function to check if all required fields are filled based on education level
  function areRequiredFieldsFilled() {
    var educationLevel = document.getElementById('education').value;
    if (educationLevel === 'Primary') {
      return document.getElementById('primarySchoolName').value.trim() !== '';
    } else if (educationLevel === 'Secondary') {
      return document.getElementById('SecondarySchoolName').value.trim() !== '';
    } else if (educationLevel === 'University') {
      return document.getElementById('course').value.trim() !== ''
        && document.getElementById('universityName').value.trim() !== ''
        && document.getElementById('institution').value.trim() !== '';
    } else {
      return false;
    }
  }

  // Proceed button click event listener
  document.getElementById('proceedBtn').addEventListener('click', function(event) {
    if (isFormValid() && areRequiredFieldsFilled()) {
      saveFormData(); // Save data before proceeding
      window.location.href = "{% url 'work_experience' %}"; // Proceed to next page
    } else {
      showErrorMessage('Please fill all required fields.');
    }
  });

  // Function to show error message and hide after 5 seconds
  function showErrorMessage(message) {
    var errorMessage = document.getElementById('errorMessage');
    errorMessage.textContent = message;
    errorMessage.style.display = 'block';
    setTimeout(function() {
      errorMessage.style.display = 'none';
    }, 5000); // 5000 milliseconds = 5 seconds
  }
</script>
{% endblock %}
